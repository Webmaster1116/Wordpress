<?php
 namespace MailPoetVendor\Doctrine\ORM\Id; if (!defined('ABSPATH')) exit; use MailPoetVendor\Doctrine\ORM\EntityManager; use Serializable; class SequenceGenerator extends \MailPoetVendor\Doctrine\ORM\Id\AbstractIdGenerator implements \Serializable { private $_allocationSize; private $_sequenceName; private $_nextValue = 0; private $_maxValue = null; public function __construct($sequenceName, $allocationSize) { $this->_sequenceName = $sequenceName; $this->_allocationSize = $allocationSize; } public function generate(\MailPoetVendor\Doctrine\ORM\EntityManager $em, $entity) { if ($this->_maxValue === null || $this->_nextValue == $this->_maxValue) { $conn = $em->getConnection(); $sql = $conn->getDatabasePlatform()->getSequenceNextValSQL($this->_sequenceName); $this->_nextValue = (int) $conn->query($sql)->fetchColumn(); $this->_maxValue = $this->_nextValue + $this->_allocationSize; } return $this->_nextValue++; } public function getCurrentMaxValue() { return $this->_maxValue; } public function getNextValue() { return $this->_nextValue; } public function serialize() { return \serialize(['allocationSize' => $this->_allocationSize, 'sequenceName' => $this->_sequenceName]); } public function unserialize($serialized) { $array = \unserialize($serialized); $this->_sequenceName = $array['sequenceName']; $this->_allocationSize = $array['allocationSize']; } } 